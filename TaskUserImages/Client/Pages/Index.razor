@page "/"
@using Contracts.Dto;
@using Microsoft.AspNetCore.Authorization;
@using TaskUserImages.Client.API;
@inject IImageFriendsAPI api

@attribute [Authorize]

<PageTitle>Index</PageTitle>
Welcome to your new app.

<MudList>
    @foreach (UserDto user in users)
    {
        <MudListItem>
            <MudLink Href="@GetUserHref(user)">
                @user.UserName
            </MudLink>
        </MudListItem>
    }
</MudList>
@code
{
    private List<UserDto> users = new();
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);
        if (firstRender)
        {
            users = await api.GetUserProfiles(1, 10);
            StateHasChanged();
        }
    }

    private string GetUserHref(UserDto user)
    {
        return $"Profile/{user.UserName}";
    }
}